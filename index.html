<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pose Record</title>
</head>
<body>
<video id="video" autoplay playsinline muted style="width:100%;height:100%;object-fit:cover;"></video>
<script>
let mediaRecorder;
let recordedChunks = [];
let stream;

// 启动摄像头
async function startCamera() {
  stream = await navigator.mediaDevices.getUserMedia({
    video: { width: 1280, height: 720 },
    audio: true
  });
  document.getElementById('video').srcObject = stream;
}
startCamera();

// 开始录制
window.startRecord = () => {
  if (!stream) return;
  recordedChunks = [];
  mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=vp9' });
  mediaRecorder.ondataavailable = e => { if(e.data.size>0) recordedChunks.push(e.data); };
  mediaRecorder.onstop = () => {
    const blob = new Blob(recordedChunks, { type: 'video/webm' });
    const url = URL.createObjectURL(blob);
    if(window.flutter_inappwebview){
      window.flutter_inappwebview.callHandler('onRecordFinish', url);
    }
  };
  mediaRecorder.start();
  console.log("Recording started");
};

// 停止录制
window.stopRecord = () => {
  if(mediaRecorder && mediaRecorder.state === "recording"){
    mediaRecorder.stop();
    console.log("Recording stopped");
  }
};
</script>
</body>
</html>
